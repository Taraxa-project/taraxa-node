<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TARAXA: Rewards distribution algorithm</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TARAXA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_rewards_distribution.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Rewards distribution algorithm </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The main goal of fair rewards distribution is to motivate validators to participate in all steps of the validation process(creating high-quality DAG blocks, creating PBFT blocks, voting for PBFT blocks) as much as possible.</p>
<h1><a class="anchor" id="autotoc_md247"></a>
Glossary</h1>
<ul>
<li>DAG blocks are stored in DAG(Directed Acyclic Graph) structure and have transactions inside it.</li>
<li>PBFT block is finalizing part of ordered DAG blocks from DAG structure and transactions from them.</li>
<li>Reward votes is finalized votes from PBFT block. Block <code>N</code> is finalizing votes from block <code>N - 1</code>.</li>
</ul>
<p>More info could be found in this <a href="https://medium.com/taraxa-project/tagged/taraxa-tech">series of medium articles</a></p>
<h1><a class="anchor" id="autotoc_md248"></a>
Rewards sources</h1>
<p>There are 2 sources of tokens, which are distributed as rewards:</p><ul>
<li>Newly created tokens. Rewards depend on total delegations in the network and is equal to 20% of it per year. So block reward is equal to <code>total_delegated_amount * 20% / block_per_year</code>. It could change from block to block as total delegated amount is changing.</li>
<li>Transactions fees is basically transaction cost. Rewards for block depends on transactions that are included in DAG block and its uniqueness.</li>
</ul>
<h1><a class="anchor" id="autotoc_md249"></a>
Rewards distribution</h1>
<h2><a class="anchor" id="autotoc_md250"></a>
Beneficial work in network</h2>
<p>There are 3 types of beneficial work that result in stable network functioning:</p>
<ul>
<li>Proposing high-quality DAG blocks(for example block with 10 unique transactions has bigger value than the block with 5 transactions),</li>
<li>Proposing PBFT blocks</li>
<li>Voting for PBFT blocks</li>
</ul>
<h2><a class="anchor" id="autotoc_md251"></a>
Newly created tokens:</h2>
<ul>
<li><b>50%</b> goes proportionally to the <b>DAG blocks proposers</b>, according to block weight calculated from count of unique transactions. For example PBFT finalizes 2 DAG blocks. The first one have 3 transactions and the second have 7. So first will receive 3/10 of this reward and second one will receive 7/10 of this reward.</li>
<li><b>45%</b> of total votes reward is voters part. So voters from reward votes will receive reward calculated according to their vote weight.</li>
<li><b>5%</b> of total votes reward is part for <b>PBFT block proposer</b>. It is proportional to bonus reward votes count. Bonus reward votes are all votes over <code>2/3 + 1</code> needed threshold. So that means that <b>PBFT block proposer</b> will receive reward only for this additional votes and will receive all <b>10%</b> of reward only if all votes will be included. The rest of reward will be burned if included votes count is less than maximum possible.</li>
</ul>
<h2><a class="anchor" id="autotoc_md252"></a>
Included transactions fees:</h2>
<p>Each transaction has a different fee. Simple "token send tx" has different fee than "smart contract write tx". These fees are calculated in taraxa-evm.</p>
<ul>
<li><b>100%</b> goes to the <b>DAG blocks proposers</b></li>
</ul>
<p>Block proposer is rewarded for unique transactions included into DAG block. Unique transaction means that proposer is the first one who included it in the DAG block according to DAG order. It might motivate validators to not include transactions that was already included by other proposers and to prioritize transactions with higher fees. On the other hand if there would be equal reward for all transaction types, it would motivate validators to prioritize more simple transactions (which require less work to process). This way there is also a possibility for users to try to make their transactions being processed faster by specifying higher gas price.</p>
<h1><a class="anchor" id="autotoc_md253"></a>
Validators statistics</h1>
<p>Rewards distribution described in the previous section is based on validators statistic in current PBFT round. Such statistics consists of:</p><ul>
<li>PBFT block author</li>
<li>Total unique transactions count</li>
<li>Total votes weight</li>
<li>Max block votes weights</li>
<li>for each validator:<ul>
<li>Number of included unique transactions</li>
<li>Vote weight</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md254"></a>
Example:</h1>
<h2><a class="anchor" id="autotoc_md255"></a>
DAG structure:</h2>
<p><img src="./images/DAG_unordered.png?raw=true" alt="Unoreded DAG blocks" title="Unordered DAG blocks" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md256"></a>
PBFT block</h2>
<p>Let's say PBFT consensus was reached on PBFT block produced by <code>Validator A</code> on this DAG and it is ordered as follows:</p>
<p><img src="./images/DAG_ordered.png?raw=true" alt="Oreded DAG blocks" title="Ordered DAG blocks" class="inline"/></p>
<p>Block votes:</p><ol type="1">
<li>Validator A weight 1</li>
<li>Validator B weight 3</li>
<li>Validator C weight 2</li>
<li>Validator D weight 4</li>
</ol>
<h2><a class="anchor" id="autotoc_md257"></a>
Statistics</h2>
<ol type="1">
<li>PBFT block author is <code>Validator A</code></li>
<li>Total unique transactions count is <code>8</code></li>
<li>Total votes weight is <code>10</code></li>
<li>Max block votes weights is <code>11</code></li>
<li>Validator statistics:</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Validator   </th><th class="markdownTableHeadNone">Rewardable DAG blocks   </th><th class="markdownTableHeadNone">Vote weight    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Validator A   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Validator B   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Validator C   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Validator D   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Validator E   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md258"></a>
Rewards</h2>
<p>Newly generated tokens amount per year is equal to total delegated amount multiplied by yield percentage. So every new block will create a reward is equal to newly generated tokens amount per year divided by estimated blocks count per year. All following calculations would be described with a pseudocode. Let's put some random values to show the calculations: </p><div class="fragment"><div class="line">total_delegated_amount = 10_000_000_000</div>
<div class="line">yield_percentage = 20%</div>
<div class="line">new_tokens_per_year = total_delegated_amount * yield_percentage // 2_000_000_000</div>
<div class="line">blocks_per_year = 20_000</div>
<div class="line">block_generated_reward = new_tokens_per_year / blocks_per_year // 100_000</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md259"></a>
DAG blocks rewards</h3>
<p>Voters rewards calculation </p><div class="fragment"><div class="line">dag_blocks_reward_part = block_generated_reward * 50% // 50_000</div>
<div class="line">total_rewardable_dag_count = 5</div>
<div class="line"> </div>
<div class="line">validator_A_dag_count = 1</div>
<div class="line">validator_A_dag_reward = dag_blocks_reward_part * validator_A_dag_count / block_total_votes_weight // 5_000</div>
<div class="line"> </div>
<div class="line">validator_B_dag_count = 3</div>
<div class="line">validator_B_dag_reward = dag_blocks_reward_part * validator_B_dag_count / block_total_votes_weight // 15_000</div>
<div class="line"> </div>
<div class="line">validator_C_dag_count = 0</div>
<div class="line">validator_C_dag_reward = 0</div>
<div class="line"> </div>
<div class="line">validator_D_dag_count = 2</div>
<div class="line">validator_C_dag_reward = dag_blocks_reward_part * validator_C_dag_count / block_total_votes_weight // 10_000</div>
<div class="line"> </div>
<div class="line">validator_E_dag_count = 4</div>
<div class="line">validator_E_dag_reward = dag_blocks_reward_part * validator_E_dag_count / block_total_votes_weight // 20_000</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md260"></a>
PBFT proposer reward</h3>
<p>PBFT proposer gets reward for bonus votes, as described above. We have 5% in config, so: </p><div class="fragment"><div class="line">max_pbft_proposer_reward = block_generated_reward * 5% // 5_000</div>
<div class="line">block_max_votes_weight = 11</div>
<div class="line">two_t_plus_one = block_max_votes_weight * 2 / 3 + 1 // 8</div>
<div class="line">block_total_votes_weight = 10</div>
<div class="line">block_bonus_reward_votes = block_total_votes_weight - two_t_plus_one // 2</div>
<div class="line">block_total_bonus_reward_votes = block_max_votes_weight - two_t_plus_one // 3</div>
<div class="line">proposer_reward = max_proposer_reward * block_bonus_reward_votes / block_total_bonus_reward_votes // 3_333</div>
<div class="line">burned_amount = max_proposer_reward - proposer_reward // 1667</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md261"></a>
PBFT voters reward</h3>
<p>Rewards for the votes is calculated from left part. 100% - 50% - 5% = 45%. So we have this calculations: </p><div class="fragment"><div class="line">pbft_voters_reward = block_generated_reward * 45% // 45_000</div>
<div class="line">block_total_votes_weight = 10</div>
<div class="line"> </div>
<div class="line">validator_A_vote_weight = 1</div>
<div class="line">validator_A_vote_reward = pbft_voters_reward * validator_A_vote_weight / block_total_votes_weight // 4_500</div>
<div class="line"> </div>
<div class="line">validator_B_vote_weight = 3</div>
<div class="line">validator_B_vote_reward = pbft_voters_reward * validator_B_vote_weight / block_total_votes_weight // 13_500</div>
<div class="line"> </div>
<div class="line">validator_C_vote_weight = 2</div>
<div class="line">validator_C_vote_reward = pbft_voters_reward * validator_C_vote_weight / block_total_votes_weight // 9_000</div>
<div class="line"> </div>
<div class="line">validator_D_vote_weight = 4</div>
<div class="line">validator_D_vote_reward = pbft_voters_reward * validator_D_vote_weight / block_total_votes_weight // 18_000</div>
<div class="line"> </div>
<div class="line">validator_E_vote_weight = 0</div>
<div class="line">validator_E_vote_reward = 0</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
