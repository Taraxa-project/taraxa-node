# Enable testing for current directory and below.
enable_testing()

set(TEST_LIBS gtest jsonrpccpp-common jsonrpccpp-client)
add_custom_target(build_all_tests)
macro(taraxa_test cpp_file_path)
    get_filename_component(_test_name ${cpp_file_path} NAME_WE)
    string(REPLACE "${CMAKE_CURRENT_SOURCE_DIR}/" "" _test_name ${_test_name})
    string(REPLACE "/" "_" _test_name ${_test_name})
    add_executable(${_test_name} ${cpp_file_path})
    target_link_libraries(${_test_name} app_base ${TEST_LIBS})
    add_test(${_test_name} ${_test_name})
    add_dependencies(build_all_tests ${_test_name})
endmacro()

taraxa_test(pbft_manager_test.cpp)
taraxa_test(pbft_chain_test.cpp)
taraxa_test(network_test.cpp)
taraxa_test(transaction_test.cpp)
taraxa_test(dag_block_test.cpp)
taraxa_test(crypto_test.cpp)
taraxa_test(dag_test.cpp)
taraxa_test(p2p_test.cpp)
taraxa_test(pbft_rpc_test.cpp)
taraxa_test(full_node_test.cpp)
taraxa_test(replay_protection_service_test.cpp)
taraxa_test(final_chain_test.cpp)
taraxa_test(state_api_test.cpp)
taraxa_test(taraxa_test.cpp)